# fudanagashi

百人一首の「札流し」をブラウザだけで練習できるシンプルなPWAです。100枚の取り札画像と決まり字データをあらかじめ含んでおり、通信が不安定な場所でもテンポを崩さずに練習できます。

## 公開ページ

- https://kg9n3n8y.github.io/fudanagashi/

## 主な機能

- **トップ画面での進行管理**：使用する札の枚数を確認しつつ「札流しを開始」ボタンでメインモードに遷移できます。完走後は自動でトップへ戻ります。
- **使う札のカスタム設定**：決まり字の1文字目（1枚札は一括）ごとにオン／オフを切り替え、選択状態をブラウザに保存します。
- **直近3回のタイム履歴**：計測結果と使用枚数をローカルに保持し、トップ画面に最新3回分を表示します。
- **取り札の自動シャッフル**：`fudalist.js`に定義された100枚すべてを毎回ランダム順に並べ替えて出題します。
- **ワンタップで計時**：最初の札をめくった瞬間に計時を開始し、最後の札で終了時間をアラート表示します。
- **決まり字の即時表示**：任意のタイミングで「決まり字を見る」ボタンを押すと該当札の決まり字が画面中央に大きく表示されます。
- **カード画像の先読み**：`requestIdleCallback`を活用し、アイドル時間に札画像を小分けに読み込んで次の札表示を滑らかにします。
- **オフライン対応**：`sw.js`と`manifest.json`により、初回アクセス後はオフラインでも札画像を含むアプリ全体を利用できます。

## 使い方

1. 上記URLを開くかローカルでホストした`index.html`にアクセスします。
2. トップ画面で現在の使用枚数を確認し、必要に応じて「使う札を設定」モーダルから決まり字グループ単位でオン／オフを切り替えます。
3. 「札流しを開始」ボタンでメインモードへ入り、画面中央の取り札画像をタップすると計時が始まります。札はランダムな順番・向きで表示されます。
4. 決まり字を確認したいときは「決まり字を見る」ボタンを押します。札を進めるか画像をタップすると非表示に戻ります。
5. すべての設定済み枚数を取り終えるとアラートで経過時間が表示されトップ画面へ戻ります。計測結果と使用枚数は直近3回まで記録欄に蓄積されます。

## ファイル構成

- `index.html`：メタ情報・UI骨格・Service Worker登録。
- `script.js`：札のシャッフル、計時、ボタン挙動、画像先読みなどメインロジック。
- `fudalist.js`：札番号・決まり字・正位置／逆位置画像パスのリスト。
- `style.css`：和風テーマのスタイル設定とタッチ操作向け最適化。
- `sw.js`：静的アセットと札画像をキャッシュするService Worker。
- `manifest.json`：PWAとしてホーム画面追加時のメタ情報。
- `torifuda/`：通常・裏返しの札画像（各100枚＋待機画面用1枚）。

## カスタマイズメモ

- 札データの追加・修正は`fudalist.js`の配列を編集します。画像パスが正しく`torifuda/`内を指していることを確認してください。
- 配色やレイアウトを変えたい場合は`style.css`のテーマカラーを調整します。
- キャッシュバージョンを更新したい場合は`sw.js`の`CACHE_NAME`を変更し、デプロイ後に再読み込みしてください。
